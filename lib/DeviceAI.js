var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _require=require('react-native'),Platform=_require.Platform,Dimensions=_require.Dimensions;var AzureOpenAI=require('./AzureOpenAI.js');var NativeDeviceAI=null;try{var NativeModule=require('./NativeDeviceAI.js');NativeDeviceAI=NativeModule;}catch(error){console.log('Native DeviceAI module not available, using JavaScript fallback:',error.message);}var DeviceAI=function(){function DeviceAI(){(0,_classCallCheck2.default)(this,DeviceAI);this.deviceInfo=null;this.lastUpdate=null;this.cacheTimeout=5*60*1000;this._autoConfigureFromEnvironment();}return(0,_createClass2.default)(DeviceAI,[{key:"_autoConfigureFromEnvironment",value:function _autoConfigureFromEnvironment(){try{var envConfig=AzureOpenAI.AzureOpenAI.loadFromEnvironment();if(envConfig){this.configure(envConfig);console.log('Azure OpenAI auto-configured from environment variables');}}catch(error){console.log('Environment configuration not available - manual configuration required');}}},{key:"configure",value:function configure(config){AzureOpenAI.setConfig(config);}},{key:"getDeviceInsights",value:(function(){var _getDeviceInsights=(0,_asyncToGenerator2.default)(function*(){try{var deviceData=yield this._collectDeviceInfo();var aiInsights;try{aiInsights=AzureOpenAI.isConfigured()?yield AzureOpenAI.generateInsights(deviceData,'general'):this._generateFallbackInsights(deviceData);}catch(aiError){console.log('AI service unavailable, using fallback insights:',aiError.message);aiInsights=this._generateFallbackInsights(deviceData);}return{success:true,deviceInfo:deviceData,insights:aiInsights,recommendations:this._generateBasicRecommendations(deviceData),timestamp:new Date().toISOString()};}catch(error){console.error('Error getting device insights:',error);return{success:false,error:error.message,timestamp:new Date().toISOString()};}});function getDeviceInsights(){return _getDeviceInsights.apply(this,arguments);}return getDeviceInsights;}())},{key:"getBatteryAdvice",value:(function(){var _getBatteryAdvice=(0,_asyncToGenerator2.default)(function*(){try{var deviceData=yield this._collectDeviceInfo();var batteryData=this._extractBatteryInfo(deviceData);var aiAdvice;try{aiAdvice=AzureOpenAI.isConfigured()?yield AzureOpenAI.generateInsights(batteryData,'battery'):this._generateFallbackBatteryAdvice(batteryData);}catch(aiError){console.log('AI service unavailable, using fallback battery advice:',aiError.message);aiAdvice=this._generateFallbackBatteryAdvice(batteryData);}return{success:true,batteryInfo:batteryData,advice:aiAdvice,tips:this._getBatteryTips(),timestamp:new Date().toISOString()};}catch(error){console.error('Error getting battery advice:',error);return{success:false,error:error.message,timestamp:new Date().toISOString()};}});function getBatteryAdvice(){return _getBatteryAdvice.apply(this,arguments);}return getBatteryAdvice;}())},{key:"getPerformanceTips",value:(function(){var _getPerformanceTips=(0,_asyncToGenerator2.default)(function*(){try{var deviceData=yield this._collectDeviceInfo();var performanceData=this._extractPerformanceInfo(deviceData);var aiTips;try{aiTips=AzureOpenAI.isConfigured()?yield AzureOpenAI.generateInsights(performanceData,'performance'):this._generateFallbackPerformanceTips(performanceData);}catch(aiError){console.log('AI service unavailable, using fallback performance tips:',aiError.message);aiTips=this._generateFallbackPerformanceTips(performanceData);}return{success:true,performanceInfo:performanceData,tips:aiTips,recommendations:this._getPerformanceRecommendations(),timestamp:new Date().toISOString()};}catch(error){console.error('Error getting performance tips:',error);return{success:false,error:error.message,timestamp:new Date().toISOString()};}});function getPerformanceTips(){return _getPerformanceTips.apply(this,arguments);}return getPerformanceTips;}())},{key:"queryDeviceInfo",value:(function(){var _queryDeviceInfo=(0,_asyncToGenerator2.default)(function*(prompt){if(!prompt||typeof prompt!=='string'||prompt.trim().length===0){return{success:false,error:'Please provide a valid prompt question',timestamp:new Date().toISOString()};}try{var deviceData=yield this._collectDeviceInfo();var relevantData=this._extractRelevantDataForPrompt(prompt,deviceData);var aiResponse;try{if(AzureOpenAI.isConfigured()){aiResponse=yield AzureOpenAI.generateCustomResponse(prompt,relevantData);}else{aiResponse=this._generateFallbackResponse(prompt,relevantData);}}catch(aiError){console.log('AI service unavailable, using fallback response:',aiError.message);aiResponse=this._generateFallbackResponse(prompt,relevantData);}return{success:true,prompt:prompt.trim(),response:aiResponse,relevantData:relevantData,timestamp:new Date().toISOString()};}catch(error){console.error('Error processing device info query:',error);return{success:false,error:error.message,timestamp:new Date().toISOString()};}});function queryDeviceInfo(_x){return _queryDeviceInfo.apply(this,arguments);}return queryDeviceInfo;}())},{key:"_collectDeviceInfo",value:(function(){var _collectDeviceInfo2=(0,_asyncToGenerator2.default)(function*(){if(this.deviceInfo&&this.lastUpdate&&Date.now()-this.lastUpdate<this.cacheTimeout){return this.deviceInfo;}try{if(NativeDeviceAI&&NativeDeviceAI.getDeviceInfo){var nativeInfo=yield NativeDeviceAI.getDeviceInfo();this.deviceInfo={...nativeInfo,screen:{width:nativeInfo.screenResolution.split('x')[0]||0,height:nativeInfo.screenResolution.split('x')[1]||0},memoryUsagePercentage:Math.round(nativeInfo.usedMemory/nativeInfo.totalMemory*100),storageUsagePercentage:Math.round(nativeInfo.usedStorage/nativeInfo.totalStorage*100)};this.lastUpdate=Date.now();return this.deviceInfo;}}catch(nativeError){console.log('Native module unavailable, falling back to JS implementation:',nativeError.message);}var screenData=Dimensions.get('screen');var windowData=Dimensions.get('window');var deviceInfo={platform:Platform.OS,version:Platform.Version,screen:{width:screenData.width,height:screenData.height,scale:screenData.scale,fontScale:screenData.fontScale},window:{width:windowData.width,height:windowData.height},memory:this._getMockMemoryInfo(),storage:this._getMockStorageInfo(),battery:this._getMockBatteryInfo(),cpu:this._getMockCPUInfo(),network:this._getMockNetworkInfo(),timestamp:new Date().toISOString()};if(Platform.OS==='windows'){deviceInfo.windowsSpecific=yield this._collectWindowsInfo();}this.deviceInfo=deviceInfo;this.lastUpdate=Date.now();return deviceInfo;});function _collectDeviceInfo(){return _collectDeviceInfo2.apply(this,arguments);}return _collectDeviceInfo;}())},{key:"_collectWindowsInfo",value:(function(){var _collectWindowsInfo2=(0,_asyncToGenerator2.default)(function*(){return{osVersion:'Windows 11',buildNumber:'22000',systemArchitecture:'x64',installedRam:'16 GB',processorName:'Intel Core i7',diskSpace:{total:'512 GB SSD',available:'256 GB'},runningProcesses:45,systemUptime:'2 days, 14 hours'};});function _collectWindowsInfo(){return _collectWindowsInfo2.apply(this,arguments);}return _collectWindowsInfo;}())},{key:"_extractBatteryInfo",value:function _extractBatteryInfo(deviceData){return{platform:deviceData.platform,batteryLevel:deviceData.battery.level,batteryState:deviceData.battery.state,powerSaveMode:deviceData.battery.powerSaveMode,screenBrightness:deviceData.screen.scale};}},{key:"_extractPerformanceInfo",value:function _extractPerformanceInfo(deviceData){return{platform:deviceData.platform,memory:deviceData.memory,cpu:deviceData.cpu,storage:deviceData.storage,screen:deviceData.screen};}},{key:"_extractRelevantDataForPrompt",value:function _extractRelevantDataForPrompt(prompt,deviceData){var promptLower=prompt.toLowerCase();var relevantData={platform:deviceData.platform,version:deviceData.version};if(this._isPromptAbout(promptLower,['battery','power','charge','energy'])){relevantData.battery=deviceData.battery;relevantData.batteryLevel=deviceData.battery?.level;relevantData.batteryState=deviceData.battery?.state;}if(this._isPromptAbout(promptLower,['cpu','processor','performance','speed','temperature','hot'])){relevantData.cpu=deviceData.cpu;}if(this._isPromptAbout(promptLower,['memory','ram','usage','available'])){relevantData.memory=deviceData.memory;relevantData.memoryUsagePercentage=deviceData.memoryUsagePercentage;}if(this._isPromptAbout(promptLower,['storage','disk','space','capacity','free'])){relevantData.storage=deviceData.storage;relevantData.storageUsagePercentage=deviceData.storageUsagePercentage;}if(this._isPromptAbout(promptLower,['screen','display','resolution','size','brightness'])){relevantData.screen=deviceData.screen;}if(this._isPromptAbout(promptLower,['network','wifi','internet','connection','speed'])){relevantData.network=deviceData.network;}if(this._isPromptAbout(promptLower,['windows','os','system','uptime','processes'])&&deviceData.windowsSpecific){relevantData.windowsSpecific=deviceData.windowsSpecific;}if(Object.keys(relevantData).length===2){relevantData.summary={battery:deviceData.battery?.level||'Unknown',memory:deviceData.memory?.usedPercentage||'Unknown',storage:deviceData.storage?.usedPercentage||'Unknown',cpu:deviceData.cpu?.usage||'Unknown'};}return relevantData;}},{key:"_isPromptAbout",value:function _isPromptAbout(prompt,keywords){return keywords.some(keyword=>prompt.includes(keyword));}},{key:"_generateFallbackResponse",value:function _generateFallbackResponse(prompt,relevantData){var promptLower=prompt.toLowerCase();if(this._isPromptAbout(promptLower,['cpu','processor','cores'])&&relevantData.cpu){return`Your CPU is running at ${relevantData.cpu.usage}% usage with ${relevantData.cpu.cores} cores.`;}if(this._isPromptAbout(promptLower,['battery','power','charge'])&&relevantData.battery){var level=relevantData.battery.level||relevantData.batteryLevel;var state=relevantData.battery.state||relevantData.batteryState;return`Your battery is at ${level}% and ${state==='charging'?'charging':'not charging'}.`;}if(this._isPromptAbout(promptLower,['memory','ram'])&&relevantData.memory){var used=relevantData.memoryUsagePercentage||relevantData.memory.usedPercentage;return`Your device is using ${used}% of available memory (${relevantData.memory.used} of ${relevantData.memory.total}).`;}if(this._isPromptAbout(promptLower,['storage','disk','space'])&&relevantData.storage){var _used=relevantData.storageUsagePercentage||relevantData.storage.usedPercentage;return`Your storage is ${_used}% full with ${relevantData.storage.available} available space.`;}if(this._isPromptAbout(promptLower,['screen','display','resolution'])&&relevantData.screen){return`Your screen resolution is ${relevantData.screen.width}x${relevantData.screen.height} with scale factor ${relevantData.screen.scale}.`;}if(this._isPromptAbout(promptLower,['network','wifi','internet'])&&relevantData.network){return`You're connected via ${relevantData.network.type} with ${relevantData.network.strength} signal strength.`;}if(this._isPromptAbout(promptLower,['windows','os','system','processes'])&&relevantData.windowsSpecific){return`Your system is running ${relevantData.windowsSpecific.osVersion} with ${relevantData.windowsSpecific.runningProcesses} running processes.`;}if(relevantData.summary){return`Your ${relevantData.platform} device: Battery ${relevantData.summary.battery}%, Memory ${relevantData.summary.memory}%, Storage ${relevantData.summary.storage}%, CPU ${relevantData.summary.cpu}%.`;}return`Your ${relevantData.platform} device (version ${relevantData.version}) is currently running.`;}},{key:"_generateFallbackInsights",value:function _generateFallbackInsights(deviceData){return`Your ${deviceData.platform} device appears to be running well. Consider optimizing battery usage and clearing storage space for better performance. Regular maintenance can help keep your device running smoothly.`;}},{key:"_generateFallbackBatteryAdvice",value:function _generateFallbackBatteryAdvice(batteryData){var level=batteryData.batteryLevel;if(level<20){return"Your battery is running low. Consider enabling power save mode and reducing screen brightness.";}else if(level<50){return"Your battery is at moderate levels. Closing unused apps can help extend battery life.";}return"Your battery level looks good. Maintain good charging habits for optimal battery health.";}},{key:"_generateFallbackPerformanceTips",value:function _generateFallbackPerformanceTips(performanceData){var memoryUsage=performanceData.memory.usedPercentage;if(memoryUsage>80){return"High memory usage detected. Consider closing unused applications and restarting your device.";}return"Your device performance looks good. Regular maintenance and updates can help maintain optimal performance.";}},{key:"_generateBasicRecommendations",value:function _generateBasicRecommendations(deviceData){var recommendations=[];if(deviceData.memory.usedPercentage>80){recommendations.push("High memory usage - consider closing unused apps");}if(deviceData.storage.usedPercentage>90){recommendations.push("Low storage space - clean up old files and apps");}if(deviceData.battery.level<20){recommendations.push("Low battery - enable power saving mode");}return recommendations.length>0?recommendations:["Your device is running optimally"];}},{key:"_getBatteryTips",value:function _getBatteryTips(){return["Reduce screen brightness when possible","Close unused background apps","Enable power saving mode when battery is low","Avoid extreme temperatures","Use original charger when possible"];}},{key:"_getPerformanceRecommendations",value:function _getPerformanceRecommendations(){return["Restart your device regularly","Keep apps updated to latest versions","Clear cache periodically","Monitor storage space","Close unused background applications"];}},{key:"_getMockMemoryInfo",value:function _getMockMemoryInfo(){return{total:'8 GB',used:'5.2 GB',available:'2.8 GB',usedPercentage:65};}},{key:"_getMockStorageInfo",value:function _getMockStorageInfo(){return{total:'128 GB',used:'89 GB',available:'39 GB',usedPercentage:70};}},{key:"_getMockBatteryInfo",value:function _getMockBatteryInfo(){return{level:78,state:'unplugged',powerSaveMode:false};}},{key:"_getMockCPUInfo",value:function _getMockCPUInfo(){return{cores:8,usage:25,temperature:'45°C'};}},{key:"_getMockNetworkInfo",value:function _getMockNetworkInfo(){return{type:'wifi',strength:'excellent',speed:'150 Mbps'};}},{key:"isNativeModuleAvailable",value:function isNativeModuleAvailable(){return NativeDeviceAI!==null&&typeof NativeDeviceAI.getDeviceInfo==='function';}},{key:"getSupportedFeatures",value:function getSupportedFeatures(){var features=['device-insights','battery-advice','performance-tips','fallback-mode'];if(this.isNativeModuleAvailable()){features.push('native-device-info');if(Platform.OS==='windows'){features.push('windows-system-info','wmi-queries','performance-counters');}}if(AzureOpenAI.isConfigured()){features.push('ai-powered-insights');}return features;}},{key:"getWindowsSystemInfo",value:(function(){var _getWindowsSystemInfo=(0,_asyncToGenerator2.default)(function*(){if(Platform.OS!=='windows'){throw new Error('Windows system info is only available on Windows platform');}if(!this.isNativeModuleAvailable()){throw new Error('Native module required for Windows system info');}try{return yield NativeDeviceAI.getWindowsSystemInfo();}catch(error){console.error('Error getting Windows system info:',error);throw error;}});function getWindowsSystemInfo(){return _getWindowsSystemInfo.apply(this,arguments);}return getWindowsSystemInfo;}())},{key:"getWindowsPerformanceCounters",value:(function(){var _getWindowsPerformanceCounters=(0,_asyncToGenerator2.default)(function*(){if(Platform.OS!=='windows'){throw new Error('Windows performance counters are only available on Windows platform');}if(!this.isNativeModuleAvailable()){throw new Error('Native module required for Windows performance counters');}try{var systemInfo=yield NativeDeviceAI.getWindowsSystemInfo();return systemInfo.performanceCounters;}catch(error){console.error('Error getting Windows performance counters:',error);throw error;}});function getWindowsPerformanceCounters(){return _getWindowsPerformanceCounters.apply(this,arguments);}return getWindowsPerformanceCounters;}())},{key:"getWindowsWmiData",value:(function(){var _getWindowsWmiData=(0,_asyncToGenerator2.default)(function*(){if(Platform.OS!=='windows'){throw new Error('Windows WMI data is only available on Windows platform');}if(!this.isNativeModuleAvailable()){throw new Error('Native module required for Windows WMI data');}try{var systemInfo=yield NativeDeviceAI.getWindowsSystemInfo();return systemInfo.wmiData;}catch(error){console.error('Error getting Windows WMI data:',error);throw error;}});function getWindowsWmiData(){return _getWindowsWmiData.apply(this,arguments);}return getWindowsWmiData;}())},{key:"getEnhancedBatteryInfo",value:(function(){var _getEnhancedBatteryInfo=(0,_asyncToGenerator2.default)(function*(){try{var deviceInfo=yield this.collectDeviceInfo();var batteryInfo={level:deviceInfo.battery.level,state:deviceInfo.battery.state,isCharging:deviceInfo.battery.state==='charging',timestamp:new Date().toISOString()};if(Platform.OS==='windows'&&this.isNativeModuleAvailable()){try{var windowsInfo=yield NativeDeviceAI.getWindowsSystemInfo();batteryInfo.windowsSpecific={osVersion:windowsInfo.osVersion,powerProfile:'balanced',estimatedTimeRemaining:'unknown'};}catch(error){console.warn('Could not get Windows-specific battery info:',error.message);}}return batteryInfo;}catch(error){console.error('Error getting enhanced battery info:',error);throw error;}});function getEnhancedBatteryInfo(){return _getEnhancedBatteryInfo.apply(this,arguments);}return getEnhancedBatteryInfo;}())}]);}();var deviceAIInstance=new DeviceAI();module.exports=deviceAIInstance;module.exports.DeviceAI=DeviceAI;module.exports=new DeviceAI();